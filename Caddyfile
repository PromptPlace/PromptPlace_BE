{
	# 프록시 앞단(도커 브리지 등)에서 온 X-Forwarded-* 신뢰
	servers {
		trusted_proxies static 10.0.0.0/8 172.16.0.0/12 192.168.0.0/16
	}
}

# api 도메인
api.promptplace.kr {
	encode zstd gzip

	# 보안 헤더
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Content-Type-Options "nosniff"
		Referrer-Policy "strict-origin-when-cross-origin"
	}

	# app 서비스로 프록시
	reverse_proxy app:3000 {
		# Caddy의 백엔드 헬스체크
		health_uri     /health
		health_interval 30s
		health_timeout  3s
		fail_duration   10s
	}
	
	# 액세스 로그
	log {
		output stdout
		format console
	}
}
